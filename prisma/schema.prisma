generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model RefreshTokens {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_uuid     String    @db.Uuid
  refresh_token String
  ip_address    String?   @db.VarChar(50)
  user_agent    String?
  is_revoked    Boolean?  @default(false)
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  expires_at    DateTime  @db.Timestamptz(6)
  Users         Users     @relation(fields: [user_uuid], references: [uuid], onDelete: Cascade, onUpdate: NoAction, map: "fk_user_uuid")
}

model Users {
  uuid                                 String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email                                String          @unique @db.VarChar(255)
  password                             String          @db.VarChar(255)
  display_name                         String          @db.VarChar(50)
  role                                 user_role       @default(employee)
  branch                               String?         @db.VarChar(100)
  team                                 String?         @db.VarChar(100)
  created_at                           DateTime?       @default(now()) @db.Timestamptz(6)
  updated_at                           DateTime?       @default(now()) @db.Timestamptz(6)
  deleted_at                           DateTime?       @db.Timestamptz(6)
  RefreshTokens                        RefreshTokens[]
  channels                             channels[]
  message_reads                        message_reads[]
  messages_messages_reply_toToUsers    messages[]      @relation("messages_reply_toToUsers")
  messages_messages_sender_uuidToUsers messages[]      @relation("messages_sender_uuidToUsers")
  user_roles                           user_roles[]
}

model channels {
  id                      Int                       @id @default(autoincrement())
  name                    String                    @unique @db.VarChar(255)
  icon_codepoint          Int?
  icon_color              String?                   @db.VarChar(20)
  is_active               Boolean                   @default(true)
  created_by              String?                   @db.Uuid
  created_at              DateTime                  @default(now()) @db.Timestamp(6)
  updated_at              DateTime                  @default(now()) @db.Timestamp(6)
  channel_role_visibility channel_role_visibility[]
  Users                   Users?                    @relation(fields: [created_by], references: [uuid], onUpdate: NoAction, map: "fk_channels_created_by")
  messages                messages[]
  webhook_subscriptions   webhook_subscriptions[]
}

model roles {
  id                      String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                    String                    @unique @db.VarChar(100)
  created_at              DateTime?                 @default(now()) @db.Timestamptz(6)
  channel_role_visibility channel_role_visibility[]
  user_roles              user_roles[]
}

model channel_role_visibility {
  id         Int      @id @default(autoincrement())
  channel_id Int
  role_id    String   @db.Uuid
  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)
  channels   channels @relation(fields: [channel_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_crv_channel_id")
  roles      roles    @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_crv_role_id")

  @@unique([channel_id, role_id], map: "uq_channel_role")
}

model user_roles {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_uuid  String    @db.Uuid
  role_id    String    @db.Uuid
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  roles      roles     @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_user_roles_role")
  Users      Users     @relation(fields: [user_uuid], references: [uuid], onDelete: Cascade, onUpdate: NoAction, map: "fk_user_roles_user")

  @@unique([user_uuid, role_id], map: "uq_user_role")
}

model message_reads {
  id         Int       @id
  message_id Int?
  read_at    DateTime? @db.Timetz(6)
  user_uuid  String?   @db.Uuid
  messages   messages? @relation(fields: [message_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_message_read_message_id")
  Users      Users?    @relation(fields: [user_uuid], references: [uuid], onDelete: NoAction, onUpdate: NoAction, map: "fk_message_user_uuid")
}

model messages {
  id                                Int             @id
  channel_id                        Int?
  type                              String?         @db.VarChar(20)
  content                           String?
  created_at                        DateTime?       @db.Timetz(6)
  sender_uuid                       String?         @db.Uuid
  reply_to                          String?         @db.Uuid
  message_reads                     message_reads[]
  channels                          channels?       @relation(fields: [channel_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ch_channel_id")
  Users_messages_reply_toToUsers    Users?          @relation("messages_reply_toToUsers", fields: [reply_to], references: [uuid], onDelete: NoAction, onUpdate: NoAction, map: "fk_ch_reply_to")
  Users_messages_sender_uuidToUsers Users?          @relation("messages_sender_uuidToUsers", fields: [sender_uuid], references: [uuid], onDelete: NoAction, onUpdate: NoAction, map: "fk_ch_sender_uuid")
}

model webhook_subscriptions {
  id           Int       @id
  channel_id   Int?
  url          String?   @db.VarChar(255)
  secret_token String?   @db.VarChar(255)
  created_at   DateTime? @db.Timetz(6)
  channels     channels? @relation(fields: [channel_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_web_hook_channel_id")
}

enum user_role {
  admin
  employee
}
