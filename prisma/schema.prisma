generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model RefreshTokens {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_uuid     String    @db.Uuid
  refresh_token String
  ip_address    String?   @db.VarChar(50)
  user_agent    String?
  is_revoked    Boolean?  @default(false)
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  expires_at    DateTime  @db.Timestamptz(6)
  Users         Users     @relation(fields: [user_uuid], references: [uuid], onDelete: Cascade, onUpdate: NoAction, map: "fk_user_uuid")
}

model Users {
  uuid          String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email         String          @unique @db.VarChar(255)
  password      String          @db.VarChar(255)
  display_name  String          @db.VarChar(50)
  role          user_role       @default(employee)
  branch        String?         @db.VarChar(100)
  team          String?         @db.VarChar(100)
  created_at    DateTime?       @default(now()) @db.Timestamptz(6)
  updated_at    DateTime?       @default(now()) @db.Timestamptz(6)
  deleted_at    DateTime?       @db.Timestamptz(6)
  RefreshTokens RefreshTokens[]
  channels      channels[]
}

model channels {
  id                      Int                       @id @default(autoincrement())
  name                    String                    @unique @db.VarChar(255)
  icon_codepoint          Int?
  icon_color              String?                   @db.VarChar(20)
  is_active               Boolean                   @default(true)
  created_by              String?                   @db.Uuid
  created_at              DateTime                  @default(now()) @db.Timestamp(6)
  updated_at              DateTime                  @default(now()) @db.Timestamp(6)
  channel_role_visibility channel_role_visibility[]
  Users                   Users?                    @relation(fields: [created_by], references: [uuid], onUpdate: NoAction, map: "fk_channels_created_by")
}

model roles {
  id                      String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                    String                    @unique @db.VarChar(100)
  created_at              DateTime?                 @default(now()) @db.Timestamptz(6)
  channel_role_visibility channel_role_visibility[]
}

model channel_role_visibility {
  id         Int      @id @default(autoincrement())
  channel_id Int
  role_id    String   @db.Uuid
  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)
  channels   channels @relation(fields: [channel_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_crv_channel_id")
  roles      roles    @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_crv_role_id")

  @@unique([channel_id, role_id], map: "uq_channel_role")
}

enum user_role {
  admin
  employee
}
